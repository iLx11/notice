"use strict";const h=require("electron"),x=require("path"),{ipcMain:a,BrowserWindow:d,screen:C}=require("electron"),v=()=>{a.handle("get-screen-size",()=>C.getPrimaryDisplay().size),a.on("window-on-top",(e,t)=>{const i=e.sender;d.fromWebContents(i).setAlwaysOnTop(t)}),a.on("window-min",e=>{const t=e.sender;d.fromWebContents(t).minimize()}),a.on("window-max",(e,t,i={})=>{const s=e.sender,r=d.fromWebContents(s);if(t){const{width:w,height:n}=C.getPrimaryDisplay().workAreaSize,g=Math.round((w-i.width)/2),m=Math.round((n-i.height)/2);r.setBounds({...i,x:g,y:m})}else r.maximize()}),a.on("window-close",e=>{const t=e.sender;d.fromWebContents(t).close()}),a.on("window-hide",e=>{const t=e.sender;d.fromWebContents(t).hide()})},z=require("path"),o=class o{constructor(){this.getWindowById=t=>h.BrowserWindow.fromId(t),this.defaultConfig={id:null,title:"",width:null,height:null,minWidth:null,minHeight:null,route:"",resizable:!0,maximize:!1,backgroundColor:"#eee",data:null,isMultiWindow:!1,isMainWin:!1,parentId:null,modal:!0},this.defaultOptions={width:900,height:700,center:!0,frame:!1,show:!1,transparent:!0,maxWidth:null,maxHeight:null,minWidth:null,minHeight:null,backgroundColor:"rgba(0,0,0,0)",autoHideMenuBar:!0,resizable:!0,minimizable:!0,maximizable:!0,modal:!0,parent:null,webPreferences:{contextIsolation:!0,webSecurity:!1,nodeIntegration:!0,preload:z.join(__dirname,"../preload/preload.js")}}}createWindow(t,i){var M;let s=0;if(o.group.some((f,b)=>(s=b,f.route===t.route))){(M=this.getWindowById(s+1))==null||M.blur();return}let r=Object.assign({},this.defaultConfig,t),w=Object.assign({},this.defaultOptions,i);!r.isMainWin&&o.main&&(w.parent=o.main);let n=new h.BrowserWindow(w);console.log("window id:"+n.id),o.group[n.id-1]={windowId:n.id,route:r.route},r.maximize&&r.resizable&&n.maximize(),r.isMainWin?(o.main&&(delete o.group[0],o.main.close()),o.main=n):n.setIgnoreMouseEvents(!0,{forward:!0});let g=this;n.on("close",()=>{o.group.forEach((f,b)=>{this.getWindowById(f.windowId)==n&&(n.webContents.closeDevTools(),delete o.group[b]),n==g.main&&h.app.quit()}),n.setOpacity(0)}),n.on("ready-to-show",()=>{n.show(),n.focus()});let m;h.app.isPackaged?n.loadFile(x.join(__dirname,"../../dist/index.html"),{hash:r.route}):(m=r.route?`${process.env.VITE_DEV_SERVER_URL}/#${r.route}`:`${process.env.VITE_DEV_SERVER_URL}}/#`,n.loadURL(m)),n.setMenu(null),n.once("ready-to-show",()=>{n.show()})}};o.main=null,o.group=[],o.getMainWindow=()=>o.main;let c=o;const E=require("electron-store"),y=new E,q=(e,t)=>{y.set(e,t)},B=e=>y.get(e),R=e=>{y.delete(e)},{app:l,protocol:T,BrowserWindow:W,screen:j,ipcMain:u,Menu:$,Tray:D}=require("electron"),O=require("path");v();u.on("set-item",(e,t,i)=>{q(t,i)});u.on("del-item",(e,t)=>{R(t)});u.handle("get-item",async(e,t)=>await B(t));u.on("window-create",(e,t,i)=>{new c().createWindow(t,i)});u.on("store-set",(e,t)=>{for(const i of W.getAllWindows())i!=W.fromWebContents(e.sender)&&i.webContents.send("store-get",t)});const I=async()=>{let e=new c;return e.createWindow({route:"/home",isMainWin:!0},{width:720,height:820,show:!1}),e};l.commandLine.appendSwitch("--ignore-certificate-errors","true");T.registerSchemesAsPrivileged([{scheme:"app",privileges:{secure:!0,standard:!0}}]);let p=null;l.whenReady().then(()=>{I(),l.on("activate",()=>{W.getAllWindows().length===0&&I()});let e=O.join(__dirname,"../../dist/icon.png");console.info(e),p=new D(e);const t=$.buildFromTemplate([{label:"显示窗口",click:()=>{c.getMainWindow().show()}},{label:"退出",click:()=>{p.destroy(),l.quit()}}]);p.setContextMenu(t),p.setToolTip("Electron")});l.on("window-all-closed",()=>{process.platform!=="darwin"&&l.quit()});
